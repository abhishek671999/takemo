<div class="main-container">
  <div mat-dialog-title class="dialog-title">
    <h2 style="margin: 0; padding: 0">Proceed??</h2>
    <button mat-icon-button aria-label="close dialog" mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div mat-dialog-content class="table-container">
    <table class="table" style="width: 100%">
      <thead class="text-center">
        <tr>
          <th class="col1">Item</th>
          <th class="col2">Quantity</th>
          <th class="col3">Rate</th>
          <th class="col4">Amt</th>
          <th class="col5">Del</th>
        </tr>
      </thead>
      <tbody class="text-center">
        <tr *ngFor="let item of summary.itemList">
          <td class="col1">{{ item.name }}</td>
          <td class="col2">
            <div class="item-quantity">
              <mat-icon (click)="subItem(item)">remove_circle</mat-icon>
              <div style="padding: 2px">
                {{ item.quantity }}
              </div>
              <mat-icon (click)="addItem(item)">add_circle</mat-icon>
            </div>
            <p
              *ngIf="restaurantParcel && item.parcel_available"
              (click)="incrementParcelQuantity(item)"
              style="text-decoration: underline; margin: 0; cursor: pointer"
            >
              Create Parcel
            </p>
            <div class="item-quantity" *ngIf="item.parcelQuantity">
              <mat-icon (click)="subParcelItem(item)">remove_circle</mat-icon>
              <div style="padding: 2px">
                {{ item.parcelQuantity }}
              </div>
              <mat-icon (click)="addParcelItem(item)">add_circle</mat-icon>
            </div>
            <p *ngIf="item.parcelQuantity">
              <b>{{ item.parcelQuantity }}</b> Parcel |
              <b>{{ item.quantity }}</b> Dine-in
            </p>
          </td>
          <td class="col3">₹{{ item.price }}</td>
          <td class="col4">{{ calculateItemAmount(item) }}</td>
          <td class="col5">
            <mat-icon (click)="clearItem(item)">delete</mat-icon>
          </td>
          <br />
          <br />
        </tr>
      </tbody>
    </table>
    <div>
      <p>Amount:&nbsp;&nbsp;₹ {{ summary.amount }}</p>
    </div>
    <small *ngIf="restaurantParcel" class="font-weight-bold text-warning"
      >Parcel charges Rs.5 per item</small
    >
    <br />
    <small
      *ngIf="isPayment && paymentMethod == 'payment_gateway'"
      class="font-weight-bold text-warning"
      >Amount inclusive of GST (5%)</small
    >
    <div *ngIf="isPayment == true">
      <!-- <mat-checkbox class="example-margin" [(ngModel)]="paybyWalletCheck" (change)="checkValue()"><b>Pay using Wallet</b></mat-checkbox> -->
      <div *ngIf="!paybyWalletCheck; else elseBlock">
        <!-- <p>Platform Fee: {{platformFee['platform_fee_percentage']}}% + Gst {{platformFee['platform_fee_gst_percentage']}}% = &nbsp;₹&nbsp;{{platformFeeAmount}}</p>
                Round Off: {{roundOffAmount}} -->
        <!-- <p>Platform Fee (Introductory offer): 0.0</p> -->
        <div class="text-center amount">
          Total Amount:&nbsp; &nbsp;₹ {{ getGrandTotalAmount() }}
        </div>
        <small
          *ngIf="isPayment && paymentMethod == 'payment_gateway'"
          class="font-weight-bold text-warning"
          >*Please use VPA/UPI id to pay if redirection to app doesn't
          work</small
        >
        <small (click)="copyMessage(upiId)">
          UPI id: <b>{{ upiId }}</b>
        </small>
        <a href="{{
          'upi://pay?pa=' + upiId + '&pn=sender&cu=INR&am=' + summary.amount
        }}"><mat-icon
          style="width: 20px; height: 20px; cursor: pointer"
          >payment  </mat-icon
        ></a>
        
        <div class="upi-transaction-form">
          <mat-form-field>
            <mat-label>Enter transaction ID after payment</mat-label>
            <input matInput placeholder="" [(ngModel)]="transactionId" />
          </mat-form-field>
          <mat-form-field>
            <mat-label>Delivery Address</mat-label>
            <input matInput placeholder="" [(ngModel)]="deliveryAddress" />
          </mat-form-field>
        </div>
      </div>
      <ng-template #elseBlock>
        <p
          [ngClass]="isWalletPayment ? 'text-primary' : 'text-warning'"
          [innerHTML]="this.walletPayMessage"
        ></p>
      </ng-template>
    </div>
  </div>
  <div mat-dialog-actions class="button-container">
    <div class="confirmation-buttons">
      <button mat-raised-button (click)="onEditButtonClick()">
        Edit Order
      </button>
    </div>
    <ng-container *ngIf="isPayment == false; else paymentGateway">
      <button
        mat-raised-button
        (click)="onConfirmButtonClick()"
        color="primary"
      >
        Confirm Order
      </button>
    </ng-container>
    <ng-template #paymentGateway>
      <ng-container
        *ngIf="
          isPayment && !paybyWalletCheck && paymentMethod == 'payment_gateway';
          else payviaVPA
        "
        ><button
          mat-raised-button
          (click)="onProceedPaymentClick()"
          color="primary"
        >
          Proceed to Pay
        </button></ng-container
      >
    </ng-template>
    <ng-template #payviaVPA>
      <div
        *ngIf="
          isPayment &&
            !paybyWalletCheck &&
            paymentMethod == 'pay_to_VPA_and_verify';
          else walletPayment
        "
        class="upi-transaction-form"
        >
        <button
          mat-raised-button
          (click)="onProceedPayViaVPAClick()"
          color="primary"
          [disabled]="transactionId == '' || deliveryAddress == ''"
        >
          Place Order
        </button>
      </div>
    </ng-template>

    <ng-template #paymentGateway>
      <ng-container
        *ngIf="isPayment == true && !paybyWalletCheck; else walletPayment"
        ><button
          mat-raised-button
          (click)="onProceedPaymentClick()"
          color="primary"
        >
          Proceed to Pay
        </button></ng-container
      >
    </ng-template>
    <ng-template #walletPayment>
      <ng-container
        *ngIf="isPayment && isWalletPayment && paybyWalletCheck; else elseBlock"
        ><button
          mat-raised-button
          (click)="onProceedwithWalletClick()"
          color="primary"
        >
          Proceed with wallet
        </button></ng-container
      >
    </ng-template>
    <ng-template #elseBlock>
      <button mat-raised-button disabled>Please wait</button>
    </ng-template>
  </div>
</div>
